# 15. 파일 시스템

## 15.1 파일과 디렉터리

### 파일 (File)

- 하드 디스크나 SSD와 같은 보조기억장치에 저장된 관련 정보의 집합
- 의미 있고 관련 있는 정보를 모은 논리적 단위

#### 파일 속성과 유형

- 속성(attribute) 또는 메타데이터(metadata)
    - 파일과 관련된 부가 정보
- 속성의 종류
    - 유형
        - 운영체제가 인식하는 파일의 종류
        - 파일 이름 뒤에 붙는 확장자(extension)을 이용하여 명시
    - 크기
    - 보호
    - 생성 날짜
    - 마지막 접근 날짜
    - 마지막 수정 날짜
    - 생성자
    - 소유자
    - 위치

#### 파일 연산을 위한 시스템 호출

- 파일을 다루는 모든 작업은 운영체제의 의해 이루어짐
- 운영체제는 파일 생성, 파일 삭제, 파일 열기, 파일 닫기, 파일 읽기, 파일 쓰기 등 파일 연산을 위한 시스템 호출을 제공

### 디렉터리 (Directory)

#### 절대 경로와 상대 경로

- 절대 경로(absolute path)
    - 루트 디렉터리에서 자기 자신까지 이르는 고유한 경로
- 상대 경로(relative path)
    - 현재 디렉터리부터 시작하는 경로

#### 디렉터리 연산을 위한 시스템 호출

- 운영체제는 디렉터리 연산을 위한 시스템 호출도 제공함

#### 디렉터리 엔트리

- 디렉터리는 내부에 해당 디렉터리에 담겨 있는 대상과 관련된 정보를 표 형태로 구성하여 저장
- 디렉터리 역시 특수한 형태의 파일로 볼 수 있음

## 15.2 파일 시스템

- 파일과 디렉터리를 보조기억장치에 저장하고 접근할 수 있게 하는 운영체제 내부의 프로그램

### 파티셔닝과 포매팅

- 파티셔닝(partitioning)
    - 저장 장치의 논리적인 영역을 구획하는 작업
    - 파티셔닝 작업을 통해 나누어진 개별 영역을 파티션이라고 함
- 포매팅(formatting)
    - 파일 시스템을 설정하여 어떤 방식으로 파일을 저장하고 관리할 것인지를 결정하고, 새로운 데이터를 쓸 준비를 하는 작업
    - 포매팅 시 파일 시스템이 결정됨
- 포매팅까지 완료하여 파일 시스템을 설정했다면 파일과 디렉터리를 설정할 수 있음

### 파일 할당 방법

- 운영체제는 파일과 디렉터리를 블록 단위로 읽고 씀
    - 하나의 파일이 보조기억장치에 저장될 때는 하나 이상의 블록에 걸쳐 저장됨
- 파일을 보조기억장치에 할당하는 방법
    - 연속 할당
    - 불연속 할당
        - 연결 할당
        - 색인 할당

#### 연속 할당(contiguous allocation)

- 가장 단순한 방식으로서, 보조기억장치 내 연속적인 블록에 파일을 할당하는 방식
- 연속 할당된 파일에 접근하기 위해서는 파일의 첫 번째 블록 주소와 블록 단위의 길이만 알고 있으면 됨
- 구현이 단순하지만, 외부 단편화를 야기한다는 문제가 있음

#### 연결 할당(linked allocation)

- 각 블록 일부에 다음 블록의 주소를 저장하여 각 블록이 다음 블록을 가리키는 형태로 할당하는 방식
- 파일을 이루는 데이터를 연결 리스트로 관리
- 불연속 할당의 일종이므로 파일이 여러 블록에 흩어져 저장되어도 무방함
- 문제점
    - 반드시 첫 번째 블록부터 하나씩 차례대로 읽어야 하므로, 파일의 중간 부분부터 접근하고 싶어도 파일의 첫 번째 블록부터 접근하여 읽어야 함
    - 하드웨어 고장이나 오류 발생 시 해당 블록 이후의 블록은 접근할 수 없음

#### 색인 할당(indexed allocation)

- 파일의 모든 블록 주소를 색인 블록(index block)이라는 하나의 블록에 모아 관리하는 방식
- 파일 내 임의의 위치에 접근하기 쉬움

### 파일 시스템 살펴보기

#### FAT 파일 시스템

- USB 메모리, SD카드 등의 저용량 저장 장치에서 사용
- 각 블록에 포함된 다음 블록의 주소들을 모은 파일 할당 테이블(FAT; File Allocation Table)로 관리하여 연결 할당의 단점을 보완
- FAT는 하드 디스크 파티션의 시작 부분에 있지만, 실행하는 도중 FAT가 메모리에 캐시될 수 있음
- FAT가 메모리에 적재된 채 실행되면 임의 접근의 성능이 개선됨

#### 유닉스 파일 시스템

- 유닉스 계열 운영체제에서 사용
- i-node(index-node)라고 하는 색인 블록을 기반으로 파일의 데이터 블록들을 찾는 방식
- 파일 속성 정보가 i-node에 표현됨
- 파일마다 i-node를 가지고 있고, 각 i-node는 번호를 부여받음
- i-node들은 파티션 내의 특정 영역에 모여있음
- i-node 하나는 열다섯 개의 블록 주소를 저장할 수 있기 때문에 그 이상 블록을 차지하는 큰 파일이 있을 경우 i-node 하나만으로는 파일의 데이터 블록을 모두 가리킬 수 없음
    - 따라서 블록 주소 중 열두 개에는 **파일 데이터가 저장된 직접 블록(direct block)** 주소를 명시
    - 위의 내용으로 충분하지 않다면 열세 번째 주소에 **파일 데이터를 저장한 블록 주소가 저장된 단일 간접 블록(single indirect block)** 주소를 저장
    - 위의 내용으로 충분하지 않다면 열네 번째 주소에 **단일 간접 블록들의 주소가 저장된 이중 간접 블록(double indirect block)** 주소를 저장
    - 위의 내용으로 충분하지 않다면 열다섯 번째 주소에 **이중 간접 블록들의 주소가 저장된 삼중 간접 블록(triple indirect block)** 주소를 저장