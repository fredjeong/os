# 13. 교착 상태

## 13.1 교착 상태란

### 식사하는 철학자 문제 (Dining Philosophers Problem)

- 교착 상태(deadlock)
    - 일어나지 않을 사건을 기다리며 진행이 멈춰 버리는 현상
- 1번 프로세스가 자원 A를 점유하고 2번 프로세스가 점유하는 자원 B를 기다리고, 2번 프로세스는 1번 프로세스의 자원 A 사용이 끝나길 기다리는 상황

### 자원 할당 그래프 (Resource-allocation Graph)

- 프로세스는 원으로, 자원의 종류는 사각형을 ㅗ표현
- 사용할 수 있는 자원이 개수는 자원 사각형 내에 점으로 표현
- 프로세스가 어떤 자원을 할당받아 사용 중이라면 자원에서 프로세스를 향해 화살표 표시
- 프로세스가 어떤 자원을 기다리고 있다면 프로세스에서 자원으로 화살표 표시
- 사이클이 발생했다면 교착 상태가 일어난 것

### 교착 상태 발생 조건

- 상호 배제(mutual exclusion)
    - 한 프로세스가 사용하는 자원을 다른 프로세스가 사용할 수 없음
- 점유와 대기(hold and wait)
    - 자원을 할당받은 상태에서 다른 자원을 할당받기를 기다리는 상태
- 비선점(non-preemtion)
    - 어떤 자원을 이용하는 프로세스의 작업이 끝나야만 다른 프로세스가 그 자원을 이용할 수 있음
- 원형 대기(circular wait)
    - 프로세스들이 원의 형태로 자원을 대기하는 것

## 13.2 교착 상태 해결 방법

### 교착 상태 예방

- 교착 상태 발생의 필요 조건 네 가지 중 하나를 충족하지 못하게 하는 방법
- 상호 배제
    - 모든 자원을 공유 가능하게 만듦으로서 예방
    - 현실에서 적용하기에는 무리가 있음
- 점유와 대기
    - 특정 프로세스에 자원을 모두 할당하거나, 아예 할당하지 않는 방식으로 자원 배분
    - 자원의 활용률이 낮아짐
    - 많은 자원을 필요로 하는 프로세스가 무한정 기다리게 되는 기아 현상을 야기할 수 있음
- 비선점
    - 선점하여 사용할 수 있는 일부 자원(CPU 등)에 대해서는 효과적
    - 프린터와 같은 자원은 선점 조건을 적용할 수 없음
- 원형 대기
    - 모든 자원에 번호를 붙이고, 오름차순으로 자원 할당
    - 모든 컴퓨터 시스템 내에 존재하는 수많은 자원에 번호를 붙이는 것은 번거롭고, 특정 자원의 활용률이 떨어질 수 있음
- 교착 상태의 발생 조건을 원천적으로 제거하여 교착 상태를 방지하는 예방 방식은 교착 상태가 발생하지 않음을 보장할 수 있지만 여러 부작용이 따름

### 교착 상태 회피

- 교착 상태를 한정된 자원의 무분별한 할당으로 인해 발생하는 문제로 간주하고, 교착 상태가 발생하지 않을 정도로만 자원을 할당하는 방식
- 안전 순서열(safe sequence)
    - 교착 상태 없이 안전하게 프로세스들에 자원을 할당할 수 있는 순서
- 상태의 분류
    - 안전 상태(safe state)
        - 교착 상태가 발생하지 않고 모든 프로세스가 정상적으로 자원을 할당받고 종료될 수 있는 상태
        - 안전 순서열이 존재
    - 불안전 상태(unsafe state)
        - 교착 상태가 발생할 수도 있는 상황
        - 안전 순서열이 존재하지 않음
- 운영체제가 교착 상태를 회피하기 위해서는 시스템 상태가 안전 상태에서 안전 상태로 움직이는 경우에만 자원을 할당하면 됨
- 따라서 교착 상태 회피 방식은 항상 안전 상태를 유지하도록 자원을 할당하는 방식이라 할 수 있음

### 교착 상태 검출 후 회복

- 교착 상태 발생을 인정하고 사후에 조치하는 방식
- 프로세스들이 자원을 요구할 때마다 모두 할당하며, 교착 상태 발생 여부를 주기적으로 검사, 교착 상태가 검출되면 회복 절차 진행

#### 선점을 통한 회복

- 교착 상태가 해결될 때까지 한 프로세스씩 자원을 몰아주는 방식
- 교착 상태가 해결될 때까지 다른 프로세스로부터 자원을 강제로 빼앗고 한 프로세스에 할당

#### 프로세스 강제 종료를 통한 회복

- 교착 상태에 놓인 프로세스를 모두 강제 종료하거나, 교착 상태가 없어질 때까지 한 프로세스씩 강제 종료